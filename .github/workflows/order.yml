name: order

on: workflow_dispatch

jobs:
  order:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install GitHub CLI
        run: sudo apt-get install gh

      - name: Authenticate with GitHub CLI
        run: |
          echo "${{ secrets.GITHUB_TOKEN }}" | gh auth login --with-token

      - name: Get issue details
        id: get_issue
        run: |
          ISSUE_NUMBER=6
          ISSUE_TITLE=$(gh issue view $ISSUE_NUMBER --json title --jq .title)
          ISSUE_BODY=$(gh issue view $ISSUE_NUMBER --json body --jq .body)
          ISSUE_AUTHOR=$(gh issue view $ISSUE_NUMBER --json author --jq .author.login)
          
          if [[ ! $ISSUE_TITLE =~ ^Order ]]; then
            echo "ISSUE_TITLE 不以 Order 开头，终止程序"
            exit 1
          fi
          REMAINING_BODY=$(echo "$ISSUE_BODY" | tail -n +2 | tr '\n' ' ')
          echo "REMAINING_BODY: $REMAINING_BODY"
          IFS=$'\n' read -r -d '' -a ENCRYPTED_ARRAY <<< "$REMAINING_BODY"
          for line in "${ENCRYPTED_ARRAY[@]}"; do
            echo "$line"
          done

   